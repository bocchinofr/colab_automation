name: Upload intraday files to Google Drive

on:
  schedule:
    - cron: '0 8 * * *'  # ogni giorno alle 10:00 italiane (8:00 UTC)
  workflow_dispatch:      # esecuzione manuale

jobs:
  upload:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install rclone
        run: |
          sudo apt-get update
          sudo apt-get install -y rclone

      - name: Configure rclone
        run: |
          mkdir -p ~/.config/rclone
          echo "${{ secrets.RCLONE_CONF }}" > ~/.config/rclone/rclone.conf
      
      - name: Debug config
        run: cat ~/.config/rclone/rclone.conf


      - name: Upload intraday files
        run: |
          DATE=$(date +'%Y-%m-%d')
          rclone copy output/intraday/dati_intraday1m_${DATE}.xlsx "gdrive:1DrrdSwWoJE89r_guvGGgpKezpim5G0lk"
          rclone copy output/intraday/riepilogo_intraday_${DATE}.xlsx "gdrive:1DrrdSwWoJE89r_guvGGgpKezpim5G0lk"
