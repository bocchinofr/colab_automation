name: Upload intraday files to Google Drive

on:
  schedule:
    - cron: '0 7 * * 2-6'  # ogni giorno alle 09:00 italiane (7:00 UTC) da MartedÃ¬ a Sabato
  workflow_dispatch:

jobs:
  upload:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install rclone
        run: |
          sudo apt-get update
          sudo apt-get install -y rclone

      - name: Configure rclone
        run: |
          mkdir -p ~/.config/rclone
          echo '${{ secrets.RCLONE_CONF }}' > ~/.config/rclone/rclone.conf


      - name: Check rclone config
        run: cat ~/.config/rclone/rclone.conf


      - name: Check intraday files
        run: |
          DATE=$(date +'%Y-%m-%d')
          echo "Listing intraday folder:"
          ls -l output/intraday/
          echo "Checking specific files:"
          ls -l output/intraday/dati_intraday1m_${DATE}.xlsx
          ls -l output/intraday/riepilogo_intraday_${DATE}.xlsx

      - name: Upload to Google Drive
        run: |
          DATE=$(date +'%Y-%m-%d')
          echo "Uploading intraday files for ${DATE}..."
          # Copia i file nella cartella 'Estrazioni finiviz yfinance/intraday'
          rclone copy "output/intraday" "gdrive:Estrazioni finiviz yfinance/intraday" --create-empty-src-dirs -v
          
      - name: Verify uploaded files
        run: |
          echo "Files now present in target folder:"
          rclone ls "gdrive:Estrazioni finiviz yfinance/intraday"



